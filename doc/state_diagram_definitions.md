# State Diagram definitions

_This document describes the definition of the State Diagram as can be edited in the State Diagram Editor ("Stadiæ")._

## Introduction

Using PlantUML, we can generate a state diagram for a _functional component_ which can be used to document the state transitions of the component, i.e. its behavior.

As an example consider the following state diagram for a functional component named `Node`:

![State Diagram](https://www.plantuml.com/plantuml/png/ZPBVQnin3CVV_LTejy4UHc3RsqgJDQGCyh0mSWTZ42ZcJctCOlbcw_PZfV_xLCVNn74OpOFnwVlHLtAagy3Qys1twZLCf_39UQkP3Tt9bzgQ3W5jpt-Wmz1wqxDnfC9tGxtssiBSU_SBxXL88d5j_Y9yK0z7GCsQCGVUlHTYN-qQR_MmOx0OWhx3y5ZpnQl6M7G3mnJIJM8h9vyh9xTlZnZ8cJoMnEXlTJjchvlVeikPzC-PjyHl5eu8MrxZ3m4Z_mQgYqhEWvAZs2sfEmidBU7N9hJxw1a-4vKAyPzfdUqT8J7e0DNATLZ1VTBgPhvkuF8oJcWsWvTluo-zgnOclYhHy-udUZP1HfSYgS53e4Olp5FViUG-jg6dQ9Ny5rjdMfpqpX0VbLbykVcwDOmx4qQBPO3HvKZwE1erNbCmR1n5c_sh9fDPrl7H_LI32nXNei3oReGy6V26YZ6gF2VQ93qLazqgeA4_qvNiOyhyVziPDIl6863Hv2bJcfSBjw6nO9d-pB8FwWgf6-pk7m00)

The above diagram can be generated by a [PlantUML server](https://plantuml.com/server) (the tool itself uses a locally running PlantUML server) and described using the following PlantUML code:

```
@startuml
'== Formatting ==
hide empty description
skinparam Arrow {
  FontSize 9
}
skinparam State {
  FontSize 12
}

'== Default interfaces ==
!$Logical = Logical
!$Timer = Timer

'== Default messages ==
!$Timer_Timeout = Timeout
!$Logical_No = No
!$Logical_Yes = Yes

'== Interfaces ==
!$RTx = RTx

'== Messages ==
!$RTx_ConnectReq = $RTx + ":" + ConnectReq
!$RTx_ConnectedInd = $RTx + ":" + ConnectedInd
!$RTx_DisconnectInd = $RTx + ":" + DisconnectInd

'== Component ==
state component as "Node" {
state START <<start>> #000000

'== States ==
state Advertising
state Connecting
state ServerConnected as "Server\nConnected"

'== Choice-points ==
state CP_Whitelisted as "Is Server\nWhitelisted?"

'== Transitions ==
START --> Advertising
Advertising --> Advertising : $Timer_Timeout
Advertising --> CP_Whitelisted : $RTx_ConnectReq\n$RTx_ConnectedInd
CP_Whitelisted --> Connecting : $Logical_Yes
CP_Whitelisted -up--> Advertising : $Logical_No
Connecting --> Advertising : $Timer_Timeout
Connecting -> ServerConnected : $RTx_ConnectedInd
ServerConnected --> Advertising : $RTx_DisconnectInd\n$Timer_Timeout
ServerConnected --> ServerConnected : $RTx_ConnectedInd
}
@enduml
```

This PlantUML code is already structured to work with the State Diagram Editor ("Stadiæ"). In the following sections, we will describe the different sections of the PlantUML code and how they are used in the State Diagram Editor.

## Definitions

In the earlier given diagram, the following sections can be identified which are indicated by the comments (comments are prefixed with the `'` character in PlantUML):

- [`Formatting`](#formatting-section)
- [`Default interfaces`](#default-interfaces-section)
- [`Default messages`](#default-messages-section)
- [`Interfaces`](#interfaces-section)
- [`Messages`](#messages-section)
- [`Component`](#component-section)
- [`States`](#states-section)
- [`Choice-points`](#choice-points-section)
- [`Transitions`](#transitions-section)
- [`Footer`](#footer-section)

In the State Diagram Editor, an empty state diagram is structured as follows:

```
@startuml
'== Formatting ==
hide empty description
skinparam Arrow {
  FontSize 9
}
skinparam State {
  FontSize 12
}

'== Default interfaces ==
!$Timer = Timer
!$Logical = Logical

'== Default messages ==
!$Timer_Timeout = "Timeout"
!$Logical_No = No
!$Logical_Yes = Yes

'== Interfaces ==

'== Messages ==

'== Component ==
state component as "Component Name" {
state START <<start>> #000000

'== States ==

'== Choice-points ==

'== Transitions ==

'== Footer ==
}
@enduml
```

Which renders as follows, showing the name of the component as `Component Name` and the `START` icon colored black:

![](https://www.plantuml.com/plantuml/png/LL31IWCn4BtdAyOgU1BKcz2MbehWmJsuU_4ux4xRmMOc9BE8blwxsUmYQmvXtkFDUydR9CDelJ-vMrYju4MZHpEMGqRko1q1-M3Vq55g8mTZ5PS-MG96zB2DKR_Wx20lYjNyG_3aBZD1RMZqN_3mc1LZsZFjiJyPU4e93vI6pAkRXZrfRx22QSfSfHbMcgUFGGRvdZnUnIZkiHstH-vjvkTIUKAhFgYG6622nUuFLUXf0UT9LJVRzmQMorBAUWtNz-MCjkKpyvZTKRcbkw0iDgERY99uQAgG5xSXwNB3lm00)

### Formatting section

In the `Formatting` section, we can specify the font size of the arrows and the states. In the example above, we have specified that the font size of the arrows is 9 and the font size of the states is 12.

```
'== Formatting ==
hide empty description
skinparam Arrow {
  FontSize 9
}
skinparam State {
  FontSize 12
}
```

The `hide empty description` keyword is used to hide the description of the states in the diagram as this PlantUML feature is not used by the State Diagram Editor.

### Default interfaces section

In the `Default interfaces` section, we can define the default interfaces that can be used in the diagram. By default, there is always the `Timer` interface and the `Logical` interface defined.

This is done using the following syntax:

```
'== Default interfaces ==
!$Timer = Timer
!$Logical = Logical
```

To define a default interface, we need to prefix the interface with a `!$` prefix, which is a PlantUML syntax for a variable definition.

### Default messages section

In the `Default messages` section, we can define the default messages that can be used in the diagram. Messages are always associated with an interface. By default, there is always the `Timeout` message of the `Timer` interface (which is used to specify a timeout) and the `Yes` and `No` messages of the `Logical` interface (which are used to specify a boolean choice exiting a choice-point) defined.

```
'== Default messages ==
!$Timer_Timeout = Timeout
!$Logical_Yes = Yes
!$Logical_No = No
```

### Interfaces section

In the `Interfaces` section, we can define the interfaces that are used in the diagram. The format for defining an interface is as follows:

```
!$InterfaceName = InterfaceName
```

Where `InterfaceName` is the name of the interface, which is always a single word.

As an example, the following line defines an interface named `RTx`:

```
!$RTx = RTx
```

### Messages section

In the `Messages` section, we can define the proprietary messages that are used in the diagram. This is done to prevent typos in the diagram when the messages are used in the transitions (see [Transitions](#transitions)).

Proprietary messages are defined using the following syntax:

```
!$InterfaceName_MessageName = $InterfaceName + ":" + MessageName
```

Where `InterfaceName` is the name of the interface (as defined in the [Interfaces](#interfaces) section) and `MessageName` is the name of the message, which is always a single word.

As mentioned before, messages are always associated with an interface and it is good practice to display the message with its interface name in the diagram.

In the example above, we have defined the following proprietary messages:

```
!$RTx_ConnectReq = $RTx + ":" + ConnectReq
!$RTx_ConnectedInd = $RTx + ":" + ConnectedInd
!$RTx_DisconnectInd = $RTx + ":" + DisconnectInd
```

### Component section

The `Component` section contains the following lines:

```
state component as "Component Name" {
  state START <<start>> #000000
```

The first line is used to specify the name of the component that the state diagram describes (in this case still the default `Component Name`). All the states, choice-points, and transitions are defined within this block. In the `Footer` section (see [Footer](#footer-section)), the block is closed with the `}` character, just before the `@enduml` keyword.

The second line is used to specify the start icon of the diagram, which is indicated by the `<<start>>` keyword and is colored black (`#000000`).

### States section

In the `States` section, we can define the states of the diagram. The format for defining a state is as follows:

```
state StateName
```

Where `StateName` is the name of the state, which is always a single word.

Optionally, a `DisplayName` can be specified for the state:

```
state StateName as "DisplayName"
```

The `DisplayName` can span multiple lines if necessary, in which case we need to use the newline character `\n`.

As an example, the following lines define three states: `Advertising`, `Connecting`, and `ServerConnected`.

```
state Advertising
state Connecting
state ServerConnected as "Server\nConnected"
```

In the example above, the developer used the `as` keyword to specify that the state `ServerConnected` should be displayed as `Server\nConnected`, and where `\n` is a newline character. This is useful if the state name is long and we want to display it on multiple lines.

### Choice-points section

A choice-point is a special type of state that is used to indicate a decision point in the diagram. The choice-point specification is indicated by the `CP_` prefix and always needs to be followed by the `as` keyword to specify the _question_ of the choice-point which will be displayed in the diagram. This is always a closed question that can be answered with `Yes` or `No` and can span multiple lines if necessary.

In the example above, we have defined a choice-point called `CP_Whitelisted` which is used to indicate whether the server is whitelisted, which is displayed as `Is Server\nWhitelisted?`.

```
state CP_Whitelisted as "Is Server\nWhitelisted?"
```

In a final diagram, a choice-point always handles two messages: `Yes` and `No`.

### Transitions section

In the `Transitions` section, we can define the transitions in the diagram.

The first transition is always the transition from the `START` state to the state in which the component starts, i.e. its _initial state_. This is illustrated in the following diagram, where the `START` state is indicated by the black `START` icon and transitions to the initial state, which is the `Advertising` state in this example:

![](https://www.plantuml.com/plantuml/png/LP5FImD13CNlyodY8WXA3tfJgBHK1G_sqEv5H6JOJRV1JcQTPFsZ-DsDq_5FBo5v-RqtX9c8-gH3sBW368_XAgRWLOaxczoQMWGClRv1Yz8awfKYEtaaxdto0QOfnHVuS616rYMz8vowpt_0KhtYBd1yOiJsjGjS-M6Z4534ToYckRtzcWB6GM4CfJDj7csSH-jklp6mMZAkMJ6jVFFZNjIljhTQzZSxsQO_p28pDhh09mCpVmJLMMNrR-DSiUS3ibdoAPVSPWcyG3Ljdp4f2N5N5NwsZjJWg8_4ccrRkKwUXPGYP_7ky1v6vxzXReBSsXzy0G00)

If the initial state is specified, in the PlantUML code, the section starts with the transition from the `START` state to the initial state.

```
START -> Advertising
```

The `->` symbol is the _connector_ and used to indicate a transition from the source state to the target state. The connector also plays a role in the layout of the diagram, as will be explained further below.

Note that in this particular case, there are no messages associated with this transition as this 'transition' is only used to indicate the start of the state machine.

After the _initial state_ is specified, the other transitions between the states are defined. A transition has a source state, a target state, and one or more messages associated with the transition, as illustrated in the following diagram:

![](https://www.plantuml.com/plantuml/png/RP11IyGm48Nl-HLZ4LHa3tfpeRAY21vS3-r549RGphR19Yd9557nlpjDOssMlOHvBr_U6xBn91qDkXDdaEVmQ9sMHCeqh4IhQWJKFNr2ZRvogYTbZV3lolJIIGrtpjaF-1R03mqLwWlXHlmiW88aOGfSNJCnjJtWNWuTWKRlPOD-x3mvBPL6En3a42VsjfRbrlBqEcB0PynuCeHkBwk_ruNLE7jC9ZhUlr2BxX1ApPZ-d6oMPEr65Uyvug3u4h9rnkS2Ebg-cwqaAi7Il1IFUuP_3blwSM9iS1K65wI7RD9l9ZXPX4hf6gH_QD8pD2NVjrPLkEgjCXGA9hjqqdX5offWBljMjqdoUlx4StyXDcZgGNU_)

In the PlantUML code, a transition is defined using the following syntax:

```
SourceState -> TargetState : Message(s)
```

The above transition indicates that the state `SourceState` transitions to the state `TargetState` when one of the messages specified after the colon are received.

Messages are predefined variables and as such are indicated by the `$` prefixed variables defined in the [Messages](#messages) section. For readability, transitions that have the same source and target states are grouped together by specifying multiple messages separated by a `\n` newline character. For example:

```
Advertising --> CP_Whitelisted : $RTx_ConnectReq\n$RTx_ConnectedInd
```

This will render as follows:

![Transition](https://www.plantuml.com/plantuml/png/PP9VIq914CNVzrDCbw27yA7U4Yp527n8GeK815dk7NN8dRtjZDaV-kwDkk7LNeRTFRyvXmFR5VL9rs7bBg3JWOUOWbSbNjZDBQb2m53h9rGePQ9QARAJL-BQ9n-WbrBSmBS3MsGTqnV2ZVjf06FrYiV0rRKH-xHxdFlrIY6WY5-WR3FFpYSKCAuLEf1FzZQCTXr6ExriCR2PFGQicEQ-_DiUJJvCjvdrnoDlUv_r8pEMEi8t0tVy9HJjmkP1EKQn6d1r2ZUrdBLjkq-INUzUzOv9IOWNcUWl8vNOgYEnDi3-q-nvIOeh4ZC4Br0C10IJxKzvSv3kYcmqIPw5b2BlR1f9qBezzMl3IV4f_wldN1Uvie_m2m00)

In the example above, the `Advertising` state transitions to the `CP_Whitelisted` choice-point (which is displayed as `Is server whitelisted?`) when the `RTx:ConnectReq` and `RTx:ConnectedInd` messages are received. This shows that the state machine can also transition to a choice-point. However, a choice-point can only handle two messages: `Yes` and `No` as illustrated in the following diagram:

![](https://www.plantuml.com/plantuml/png/LO-nJiGm38PtFuLr2rC6s40wkECaHeHK5YIMg3NKed52x0e1ujrnqmwGxV_ynRzyK8lLvZJ16UxtU9ThYcOihvvWv86GKh5F74ZxoiKu2-WRIuar9ZpMcZ_m6z0_YdNyHNW9Ft-4pgBHV-7ymWrOwzfObofjuka1e-AkoucUvNqcNVfkTfjz6ZFt54fcCNMmuSSQHNanLtZ44Avz5O2l2nEzcCTRlC8dqePywEa-Gti7ai7l_mK0)

When a choice-point already handles the `Yes` and `No` messages, no other transition can be added. Note that it is also possible for one of the `Yes` or `No` messages to be handled by another choice-point.

For layout purposes, the connector can be formatted in different ways depending on the direction of the transition. This is given in the following table.

| Name | Arrow | Direction |
|:-----|:------|:----------|
| `Right` | `->` | Horizontal rightward |
| `Left` | `-left->` | Horizontal leftward |
| `Down` | `-->` | Downward |
| `Up` | `-up->` | Upward |

Additionally, the length of an `Up` or `Down` transition can be elongated by adding one or more `-` characters before the arrow symbol `->`, for example `---->` or `-up-->`.

In the earlier example above, we have defined the transitions between the states `Advertising`, `Connecting`, `ServerConnected`, and `CP_Whitelisted`.

```
Advertising --> Advertising : $Timer_Timeout
Advertising --> CP_Whitelisted : $RTx_ConnectReq\n$RTx_ConnectedInd
CP_Whitelisted --> Connecting : $Logical_Yes
CP_Whitelisted -up--> Advertising : $Logical_No
Connecting --> Advertising : $Timer_Timeout
Connecting -> ServerConnected : $RTx_ConnectedInd
ServerConnected --> Advertising : $RTx_DisconnectInd\n$Timer_Timeout
ServerConnected --> ServerConnected : $RTx_ConnectedInd
```