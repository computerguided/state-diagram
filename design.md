# State Diagram Generator design

_The State Diagram Generator is a tool that allows you to graphically generate a PlantUML state diagram. This document describes the detailed design of the tool._

## Introduction

Using PlantUML, we can generate a state diagram for a functional component which can be used to document the state transitions of the component.

As an example consider the following state diagram for a functional component named `Node`:

![State Diagram](https://www.plantuml.com/plantuml/png/ZL9BQzj04BxhLqpLGW_5qFPM4xin3WKVQeebA0L3MAH9l5Gxg-wE-cZ8V-zujPle4Kfya5VpFURJpbnwLeuxqsIlORM2JzOPnQpfLjwoawuHqBJy1shqbTCjQqkP_wwfLKuPs3XdVy5T1Y8aBlHVX0_P_O1Gi68S4zwz5qRVxGflLDSm6FHUtQ8_ztpngjG6RSUmWdYIsjxAwzxAwTkP1lAC7ZjYT3UgIkf3-LlmNFxooFYSt1D-lRL4MF41VmWrADv0lipFpqSe7vEntb4zem_19BZIlkhBJob6g4JquOOgQrfBI0pAGxwtDUPm5x6Yt1nAkBW8argluUNRy8jV5sxOoocoD_LFTAozZ31MOiR7Ge5EE0_HGyk-TgI7QhgzxSdg2XUjrSI3DjilrrzFch7HFbdiF2IN0VGn6PLEaTUiBGMR_giMY_KeyU0ynM09QJMcj6cQ9Kp6VAJPABEn9jX4F3QJ7PkHklQ9LBANIVd_s4FMUZe68Sv3JZbpy_dA7IardCkVsVO-kqIgEzFy0m00)

The above diagram can be generated by a [PlantUML server](https://plantuml.com/server) and described using the following PlantUML code:

```
@startuml
' == Formatting ==
hide empty description
skinparam Arrow {
  FontSize 9
}
skinparam State {
  FontSize 12
}

' == Default messages ==
!$Timeout = Timeout
!$No = No
!$Yes = Yes

' == Interfaces ==
!$RTx = "RTx"

' == Messages ==
!$RTx_ConnectReq = $RTx + ":" + "ConnectReq"
!$RTx_ConnectedInd = $RTx + ":" + "ConnectedInd"
!$RTx_DisconnectInd = $RTx + ":" + "DisconnectInd"

state component as "Node" {
state START <<start>> #000000

' == States ==
state Advertising
state Connecting
state ServerConnected as "Server\nConnected"

' == Choice-points ==
state CP_Whitelisted as "Is Server\nWhitelisted?"

' == Transitions ==
START --> Advertising
Advertising --> Advertising : $Timeout
Advertising --> CP_Whitelisted : $RTx_ConnectReq\n$RTx_ConnectedInd
CP_Whitelisted --> Connecting : $Yes
CP_Whitelisted -up--> Advertising : $No
Connecting --> Advertising : $Timeout
Connecting -> ServerConnected : $RTx_ConnectedInd
ServerConnected --> Advertising : $RTx_DisconnectInd\n$Timeout
ServerConnected --> ServerConnected : $RTx_ConnectedInd
}
@enduml
```

## Definitions

In the example diagram above, the following sections can be identified which are indicated by the comments:

- `Formatting`
- `Default messages`
- `Interfaces`
- `Messages`
- `States`
- `Choice-points`
- `Transitions`

An empty state diagram is as follows:

```
@startuml
' == Formatting ==
hide empty description
skinparam Arrow {
  FontSize 9
}
skinparam State {
  FontSize 12
}

' == Default messages ==
!$Timeout = Timeout
!$No = No
!$Yes = Yes

' == Interfaces ==

' == Messages ==

state component as "Component Name" {
state START <<start>> #000000

' == States ==

' == Choice-points ==

' == Transitions ==

}
@enduml
```

Which renders as follows, showing the name of the component as `Node` and the `START` icon colored black:

![](https://www.plantuml.com/plantuml/png/LL31IWCn4BtdAyOgU1BKcz2MbehWmJsuU_4ux4xRmMOc9BE8blwxsUmYQmvXtkFDUydR9CDelJ-vMrYju4MZHpEMGqRko1q1-M3Vq55g8mTZ5PS-MG96zB2DKR_Wx20lYjNyG_3aBZD1RMZqN_3mc1LZsZFjiJyPU4e93vI6pAkRXZrfRx22QSfSfHbMcgUFGGRvdZnUnIZkiHstH-vjvkTIUKAhFgYG6622nUuFLUXf0UT9LJVRzmQMorBAUWtNz-MCjkKpyvZTKRcbkw0iDgERY99uQAgG5xSXwNB3lm00)

Note that between the `Messages` and `States` sections, the following line is always present:

```
state component as "Node" {
  state START <<start>> #000000
```

The first line is used to specify the name of the component that the state diagram describes (in this case `Node`). All the states, choice-points, and transitions are defined within this block. The block is closed with the `}` character, just before the `@enduml` keyword.

The second line is used to specify the start icon of the diagram, which is indicated by the `<<start>>` keywordand is colored black (#000000).

The sections are described in more detail in the following.

### Formatting

In the `Formatting` section, we can specify the font size of the arrows and the states. In the example above, we have specified that the font size of the arrows is 9 and the font size of the states is 12.

```
skinparam Arrow {
  FontSize 9
}
skinparam State {
  FontSize 12
}
```

### Default messages

In the `Default messages` section, we can define the default messages that can be used in the diagram. By default, there is always the `Timeout` message (which is used to specify a timeout) and the `Yes` and `No` messages (which are used to specify a boolean choice exiting a choice-point) defined.

To define a default message, we need to prefix the message with a `!$` prefix, which is a PlantUML syntax for a variable definition.

```
!$Timeout = Timeout
!$Yes = Yes
!$No = No
```

### Interfaces

In the `Interfaces` section, we can define the interfaces that are used in the diagram. The format for defining an interface is as follows:

```
!$InterfaceName = "InterfaceName"
```
Where `InterfaceName` is the name of the interface, which is always a single word.

As an example, the following line defines an interface named `RTx`:

```
!$RTx = "RTx"
```

### Messages

In the `Messages` section, we can define the proprietary messages that are used in the diagram. This is done to prevent typos in the diagram when the messages are used in the transitions (see [Transitions](#transitions)).

Proprietary messages are defined using the following syntax:

```
!$InterfaceName_MessageName = $InterfaceName + ":" + "MessageName"
```

Where `InterfaceName` is the name of the interface (as defined in the [Interfaces](#interfaces) section) and `MessageName` is the name of the message, which is always a single word.

In the example above, we have defined the following proprietary messages:

```
!$RTx_ConnectReq = $RTx + ":" + "ConnectReq"
!$RTx_ConnectedInd = $RTx + ":" + "ConnectedInd"
!$RTx_DisconnectInd = $RTx + ":" + "DisconnectInd"
```

### States

In the `States` section, we can define the states of the diagram. The format for defining a state is as follows:

```
state StateName as "DisplayName"
```

Where `StateName` is the name of the state, which is always a single word. Optionally, a `DisplayName` can be specified for the state. The `DisplayName` can span multiple lines if necessary, in which case we need to use the newline character `\n`.

As an example, the following lines define three states: `Advertising`, `Connecting`, and `ServerConnected`.

```
state Advertising
state Connecting
state ServerConnected as "Server\nConnected"
```

In the example above, the developer has specified that the state `ServerConnected` should be displayed as `Server\nConnected`, where `\n` is a newline character. This is useful if the state name is long and we want to display it on multiple lines.

### Choice-points

A choice-point is a special type of state that is used to indicate a decision point in the diagram. The choice-point specification is indicated by the `CP_` prefix and always needs to be followed by the `as` keyword to indicate how the choice-point should be displayed. This display name should always be formatted as a question and can span multiple lines if necessary.

In the example above, we have defined a choice-point called `CP_Whitelisted` which is used to indicate whether the server is whitelisted, which is displayed as `Is Server\nWhitelisted?`.

```
state CP_Whitelisted as "Is Server\nWhitelisted?"
```

In a final diagram, a choice-point always handles two messages: `Yes` and `No`.

### Transitions

In the `Transitions` section, we can define the transitions between the states. If the _initial state_ is specified, the section starts with the transition from the `START` state to the initial state. In the example, the initial state is `Advertising`.

```
START --> Advertising
```

After this, the other transitions between the states are defined. This is done using the following syntax:

```
State1 -> State2 : Message(s)
```

The above transition indicates that the state `State1` transitions to the state `State2` when the message(s) specified after the colon are received. The messages are indicated by the `$` prefixed variables defined in the [Messages](#messages) section. Normally, only one message is specified after the colon, but for readability, it is possible to combine transitions that have the same source and target states by specifying multiple messages separated by a `\n` newline character. For example:

```
Advertising --> CP_Whitelisted : $RTx_ConnectReq\n$RTx_ConnectedInd
```

For layout purposes, the arrow can be formatted in different ways depending on the direction of the transition. This is given in the following table.

| Name | Arrow | Direction |
|:-----|:------|:----------|
| `Right` | `->` | Horizontal rightward |
| `Left` | `-left->` | Horizontal leftward |
| `Down` | `-->` | Downward |
| `Up` | `-up->` | Upward |

Additionally, the length of an `Up` or `Down` transition can be elongated by adding one or more `-` characters before the arrow symbol `->`, for example `---->` or `-up-->`.

In the earlier example above, we have defined the transitions between the states `Advertising`, `Connecting`, `ServerConnected`, and `CP_Whitelisted`.

```
Advertising --> Advertising : $Timeout
Advertising --> CP_Whitelisted : $RTx_ConnectReq\n$RTx_ConnectedInd
CP_Whitelisted --> Connecting : $Yes
CP_Whitelisted -up--> Advertising : $No
Connecting --> Advertising : $Timeout
Connecting -> ServerConnected : $RTx_ConnectedInd
ServerConnected --> Advertising : $RTx_DisconnectInd\n$Timeout
ServerConnected --> ServerConnected : $RTx_ConnectedInd
```

## Editing a state diagram

_The State Diagram Editor is a tool that allows you to graphically edit a PlantUML state diagram. The following sections describe the functionality of the editor._

### Basic workflow

A basic workflow of the State Diagram Editor can be as follows:

1. Create a new state diagram.
2. Add interfaces.
3. Add messages for each interface.
4. Add states.
5. Add choice-points.
6. Add transitions.
7. Edit the diagram by selecting the elements and changing their properties.
8. Delete selected diagram elements that are no longer needed.
9. Save the diagram.
10. Open an existing diagram.

### Create a new diagram

When the user creates a new diagram, the name of the component must be specified. This name is used to identify the component that the state diagram describes.

Suppose the name is `Node`, then internally, the default PlantUML string is created as follows:

```
@startuml
' == Formatting ==
hide empty description
skinparam Arrow {
  FontSize 9
}
skinparam State {
  FontSize 12
}

' == Default messages ==
!$Timeout = Timeout
!$No = No
!$Yes = Yes

' == Interfaces ==

' == Messages ==

state component as "Node" {
state START <<start>> #000000

' == States ==

' == Choice-points ==

' == Transitions ==
}
@enduml
```

This is then rendered by the PlantUML server and displayed in the diagram canvas as shown below:

![Initial Diagram](https://www.plantuml.com/plantuml/png/LL31JiCm3BtdAyn0ueG4t93MQHC8YGCzq5uuMgstMInsbBX2CEtVITCUIWwH_VByNlosoJ3Qu4_k5geANZLwD6CvvCuTkISW7-m7UafTv62iuj8NIy287dOnwZUS7UH1iOP_2PxSPK5e38t-4nuUCsDoUw4z3YS3JodXWTBeUNNJiYST32gOgupLcjjQS_KvqY3ViyQR6CKzTjFqXBqlz5mgN-ZK1nKI0qomghMd5PpdjwRTVRImNfSeDXkulYzd4YihBCMVZyeTtGLbiGNSHfJ4Opu5lBWjIPzp_GC0)

### Selecting and deselecting diagram elements

Diagram elements - states, choice-points, and transitions - can be selected - and deselected - by clicking on them. Multiple elements can be selected in this way.

Selection is indicated as follows:

- Selected states and choice-points are indicated with a red bold border.
- Selected transitions are indicated with a red bold line.
- A selected `START` icon is colored red.

This is done in the PlantUML code as follows.

```
@startuml
' == Formatting ==
hide empty description
skinparam Arrow {
  FontSize 9
}
skinparam State {
  FontSize 12
}

' == Default messages ==
!$Timeout = Timeout
!$No = No
!$Yes = Yes

' == Interfaces ==
!$RTx = "RTx"

' == Messages ==

state component as "Node" {
state START <<start>> #FF0000

' == States ==
state Advertising #line:FF0000;line.bold

' == Choice-points ==

' == Transitions ==
START -[#FF0000,bold]-> Advertising
Advertising -[#FF0000,bold]-> Advertising : $Timeout

}
@enduml
```

This is then rendered by the PlantUML server and displayed in the diagram canvas as shown below:

![](https://www.plantuml.com/plantuml/png/VP4_JyD03CNt-nGcHMAX2DWeRTKAL8c13cqMX1YEn6qjSkVepkKF5TyT9vTAOI53uhD_VYzvcKMnGVQkCcSmcS22WxCYvBTwCZig4T3LyWKbnY9GBSJUn3VojGtMmJm4_e230LtqigPlX1lpqmFMOWN_0bVNIYItUzpOVINWC4QxnTXudfpcv93t0XFeAkqjMOzBrkgfmK3ldSQ35mmRMnotL_cdpZDzP1tns5CtiNsXWbtD7hs0ZP0jkSGC3jridSzNEOp7RJ3JAGmMYqkzabZwe5OgqVFo7ODGR18RLEHnbF3RfhvuvQhi5kzsJ0KEQoOlxNvgvy7wI4siRJEP3vyxq_D6u6KuxTkONlq_2ICuXcaqyndwKd_qBm00)

When a single element is selected - unless it is the `START` icon which has no properties - the properties panel is updated to show the properties of the selected element.

### Add an interface

Interfaces can be added to the list of interfaces by specifying the interface name, which needs to be a single word and unique.

When the interface is added, it will appear in the list of interfaces in the protocol panel and in the PlantUML code as follows:

```
!$Interface = "Interface"
```

A newly added interface is selected automatically.

### Add a message

Apart from the `Timeout`, `No`, and `Yes` messages, a message is always associated with an interface. Therefore, when adding a message, the interface needs to be selected first. When the interface is selected, the message name can be specified, which needs to be a single word and unique for the selected interface.

When a message is added, it will appear in the list of messages in the protocol panel and in the PlantUML code as follows:

```
!$Interface_Message = $Interface + ":Message"
```

### Add a state

States can be added to the list of states by specifying the state name which needs to be a single word and unique. Optionally, a display name can be specified, which can span multiple lines if necessary (indicated by the `\n` newline character). The display name does not need to be unique nor correlate to the state name, although this is normally the case. When the state is added, it will appear in the list of states and in the diagram.

For example, the following line is added to the PlantUML code to add the `Advertising` state:

```
' == States ==
state Advertising
```

The `Advertising` state is then displayed in the diagram as shown below:

![Adding a state](https://www.plantuml.com/plantuml/png/LP31JiCm38RlUGepa3WX0JUaTLe5Gk903xGNZb7hRHQBNSKk2AQzEsdJGvT3P3kVVpl_Lir76yBHtK9HmAl4uCs8zobp1-eGCFJs2nrg6wat4dRwHTpxw0EKCSeFd1oaHhQQ_X2Ut7a1rEODBu67nqJaQI-uyyFH8A2gtwEECwzk6WeeWq41SvHgbQIqaXHzZXYaUzPuOyEuystkphNtXPxJQOLMGY-CRE0LLfLqk8BJ_5OtvKS3w_LanMO3r_VJoMBJ5x9Kfilk6wEH9ezculaWrE9TByIssAA9dfL6nwRYsMsHk-JqFm00)

Note that no transitions are defined yet, so the `Advertising` state is not connected to any other state.

A newly added state is selected automatically.

### Select and edit a state

States can be selected by clicking on them in the diagram (see ["Selecting and deselecting diagram elements"](#selecting-and-deselecting-diagram-elements)).

When a single state is selected, the properties panel is updated with the state name and display name if it has been specified (left empty otherwise). These values can be changed to update the state.

### Add a choice-point

Choice-points can be added to the list of choice-points by specifying the choice-point name which needs to be a single word and unique. Optionally, a question can be specified, which can span multiple lines if necessary (indicated by the `\n` newline character). The question does not need to be unique nor correlate to the choice-point name, although this is normally the case. When the choice-point is added, it will appear in the list of choice-points and in the diagram.

For example, the following line is added to the PlantUML code to add the `Whitelisted` choice-point:

```
' == Choice-points ==
state CP_Whitelisted as "Is Server\nWhitelisted?"
```

Note that for the name, the `CP_` prefix is added automatically, i.e. not part of the specified name.

The `Whitelisted` choice-point is then displayed in the diagram as shown below:

![Adding a choice-point](https://www.plantuml.com/plantuml/png/LP1VImCn3C3V-odY57mIr3TXcniJOQ13l0CH12btsHQy9aUJKtJikzlLFinxEFBdbr_QpjHyj25qxXmc4xYN6BmPyIPbRaij0eRUlg55RIBrHi9EFuXx7ts0UOpo1Ji7QP2jeX-46xS_0YhpXl-1g-j4_6sxmxKVEeE0gdw3UjXvSbPJG1aC9b2YL5j9IbUIejS31kbV74isZ6lVvEbIUppoESr7Q2JqmiW6Nc6qaXP7i2kzgfu_rp0UvwUOJk7qCdz5bgzmK1LwtdvYD5BYJI4MMw46BteXjYDmyVJ-iYN31rB3DkzTAbGOq_mRvrQNMxUZ8ggZPoKZuQpPknboEuJk5m00)

A newly added choice-point is selected automatically.
### Select and edit a choice-point

Choice-points can be selected by clicking on them in the diagram (see ["Selecting and deselecting diagram elements"](#selecting-and-deselecting-diagram-elements)).

When a single choice-point is selected, the properties panel is updated with the name and question of the selected choice-point. These values can be changed to update the choice-point.

### Add a transition

To add a transition, a source state needs to be selected followed by a target state.

When there is no transition between the selected source and target states yet, a new transition can be added. This transition will have the default connector `->`.

For example, the following line is added to the PlantUML code to add a transition from the `Advertising` state to the `CP_Whitelisted` choice-point when no transition existed yet between these two states:

```
Advertising -> CP_Whitelisted
```

This will be displayed in the diagram as shown below:

![Adding a transition](https://www.plantuml.com/plantuml/png/NP5HIyGm3CVV-odYAVXqeBu9jtbZ8jo3Gzn0147Abhi5rtOqcQA7tzrkApBTmqZIN_v9_zsoQ2-3wTGv90dSEM-q2Db3o5HB3GAQNZwXGQuzzKBEAduZsskl3MJUkmyuAWYDLahwGhXMtmkW52tu5xYy2iGyxHRtUkW433Bh0_8uy-Ii8eDk44WWHg5Mk90MBaJF8mRX7pLsLj3lTJrtpxNxXPxYQONQcTvPj0AQOPN_PeKsk89ZfCegUwnWivbCILCulPY-MNQ-p2WQwQnvHo_4mQr8vAsZ6jUz8oiBC7zuVMf9i2CMRAODTWmb-j3_OXT7DwieL7bjcKQt9vd595Yd__HKy7EBjWcF-0C0)

A newly added transition is selected automatically allowing the transition to be edited immediately.

The connector can be changed by selecting a different connector from the list of available connectors; `Right`, `Left`, `Down`, and `Up`. Additionally, the length of an `Up` or `Down` transition can be elongated by entering an integer value larger than 1.

With the transition created, the first message can be added to the transition by selecting the message from the list of messages. This list can be filtered by selecting an interface from the list of interfaces.

For example, the following line is added to the PlantUML code to add the `$RTx_ConnectReq` message to the transition between the `Advertising` state and the `CP_Whitelisted` choice-point:

```
Advertising -> CP_Whitelisted : $RTx_ConnectReq
```

This will be displayed in the diagram as shown below:

![Adding a transition with messages](https://www.plantuml.com/plantuml/png/NP9FIyD04CNl-od6A7Wgg3TBMriYGWyMQG8Y26L9fkrWTpRkJlrZyRixn4MJvX1cNdxpTlAIQHGRPEzsvXp6OxZpmLaHuersPair0hf6Fg76M0LgX3oR-4BSs60Tp4Bmxt0me8Ci1NqXN9ll3b285Um3brTA_9vsYskxtmauZD5kCAfcJivASkZt0cD8bMeBh-t2Q_M4Ye7UayUS1SFQLkrqqkvxViloOvLxPgnaYQywdAao_5UoFeFrdEiUbRJCcDY-JkLTunbPm4R8yhzkOHrcS4XKKSwM9On6RS2J2PnUj5TQiGqcQfNeMVs6GIXgyed8jvug73IUM3fW_h1wt9BWZg9WtMumZr1WqFbdxZowoP9H6In74lBSsdHEWi7as6y8HtaP_LfJv5f_aHy0)

Any additional messages that are selected can be added to the transition as well. For example, the following line is added to the PlantUML code to add the `$RTx_ConnectedInd` message to the transition:

```
Advertising -> CP_Whitelisted : $RTx_ConnectReq\n$RTx_ConnectedInd
```

Note that the messages separated by a newline character and are displayed in this order as displayed in the diagram below:

![Adding a transition with messages](https://www.plantuml.com/plantuml/png/PP1FIyD04CNl-od6A7Wgg3TBMriYGWyMQG8Y5CgIJDl1x6pSdVZ7qk_k6XTDQWvXvkNttcxUr8jsqfXAdSDu37VM6Ir2l0sRsb69WAQM3oZH5uvg8SlAFnFNsca3C-Vi6-mL12DBHfy8r-hG0JBHWdtWyYeGFwVTuaOtbO11x_KMVT3KoLbE1cqZC8Ou1MrXmxgmONhwnY2yOyQS1Tr65wqxQlUzl6N-laujCnQon9TWJe8o_5EIFeFbdCiU5RL4AT_-Jc5DRHbPG7j8qjzjeGqci8zKbi-MEOn6RS6J2PnUj4-yObkC3rEaP-KhEY4Vcez4khDKuA2snD81quVruuu4A_A2PNk3kOSCNV2lkFFf9eb1kTFiISXo6zCv2GQJuxmX7FMrud_bA7LGK-IoCTKN)

### Add a self-transition

A self-transition is a transition where the source and target states are the same. Note that it is not possible to add a self-transition to a choice-point or to the `START` icon.

To be able to add a self-transition, only one state needs to be selected. When it is then indicated that a transition is to be added, the self-transition is added to the selected state which can then be edited in the same way as other transitions.

For example, the following line is added to the PlantUML code to add a self-transition to the `Advertising` state:

```
Advertising -> Advertising
```

Which is then displayed in the diagram as shown below:

![](https://www.plantuml.com/plantuml/png/PP9FIyD04CNl-od6A7Wgg3TBMriYGWyMQG8Y5CgIJDl1xcpSdVh7qk_kTXiqYJc4dPVVl9ayTkn5EzcPhRg4uH0Uh3DQX7WTAhMX4W5D9LzGeYySLKAMbNybhhJJ1YREsG_OAmYDB1bz8zogGmF8H0ksWUkRG9octUDAxxO21htNQ_J7cMSNEHcqEu4XrAUWpMmePpQSNeuOX7VjCML1jz95xAwrnvRVFFzSffOP2vdZMsXEWjB_Kv8sW-MKomuLjKGf7t-diAQoZ2oWFIJfRpNJ1XFOrrIMJ-Ov30OnuD48pg_YSren1XCNhEb9-OvEo8VaQoBTM2gmLrbYQO3fq_9vGu9Rye9bt63g8KCN-XVS-7INr4Qvq-n9o7AqQKo2tgZhruTENWl-5qxNehNxGOsHot2XVW00)

A newly added self-transition is selected automatically allowing the self-transition to be edited immediately.

For self-transitions, the connector is always `->`. Looking at the diagram above, this means that we need to change the connector of the transition to the `CP_Whitelisted` choice-point to `Down` (or `Up`) to make room to display the messages in the self-transition as shown below:

![](https://www.plantuml.com/plantuml/png/PP7VI_im5CNVyrVSRx-2JmFrpR7LZOgm1uUi1H468xHtMx2vgScjFnp-xrvgr7RseUIUViv9UZ8Bh3stjbQdC9t2ZVDMCnlQoQJsfa90s_0RL1XARnesZbHuDDHehotClNSlS50WHkBSl2DSgeyUaBDc70Bd5q9yxNQDMztM31P3q3iCegb_9uMnw5g6ASILQ4iduzB9wW450td7Z0Kn-gqkEtVKRWTvg-9rapaYB7c5Js9EH1d_AicGmMf1rO2AMg9Kw7wdTBPnXCIW0oJPpxJK5XCuH2elvgi29fEku3I5_sVT4u_O5HDa5UbvzOoUJP3c8v7jdIbnr3X3t0EpkytztZ3M9Z1MtGaM0NBqubzJxzDL4eCAhoaODewwcDvEC1gbnu5ZE2fiJN_Q6MQaq1_5_trjSiypfAgrzIS0)

### Specifying the initial state transition

The initial state transition indicates the first state of the component. For our example, by selecting the `START` icon and the `Advertising` state and adding a transition between them, the `Advertising` state is specified as the initial state.

This is specified using the syntax in the PlantUML code as shown below:

```
START -> Advertising
```

Which is displayed in the diagram as shown below:

![](https://www.plantuml.com/plantuml/png/PPBVIyD03CVV-rV4AlWqKDySszoe27jmo5eGOJ2EDjiETxbwb_d3uVzksftQctqekTmdtwJVTEnPETwPRN8Emo7SMMSKiwQrd9ADhX3GrFm15VhIwPgrfSG_QwgLKmOcpjats2SWXSIv_aIuJhuwGCwACGOkhuGuTBl5bTfj6GnwhzRecvudPuKsQ7SCGmYHv6PMZZChqLE3WRo3nfGOtKgLRNN8tKTwy-9zcLaYB7cEBrASIgR_bqbZ1gifLH4LSccI-FPpIcjgIqWCoaEQ_Pvcoc0A-q3bnMHUm63G6ZmQmUb5-uGHMsEyH86ULA_eM7jnFX3PnkeIUxNLn1qmUrW-RZJZLdl6gfrWwY579_KBwbpTf46eS8gyRZRNoXpcwesYbfqOUd9trAKFHoukw9zbaKOitzJ_x5AMFqQgv8_x1W00)

The initial state transition can be changed like any other transition but only the connector can be changed as no messages are associated with the initial state transition.

There can only be one initial state transition. This means that if the initial state transition is changed, any previous initial state transition is removed.

### Select and edit a transition

A transition can be selected by clicking - approximately - on the line (see ["Selecting and deselecting diagram elements"](#selecting-and-deselecting-diagram-elements)).

When a single transition is selected, the properties panel is updated to show the connector information (if it is not a self-transition) and the messages that are associated with the transition (if it is not an initial state transition).

Messages can be added like described before or removed from the transition by selecting the messages from the list and removing them.

### Deleting diagram elements

All diagram elements can be deleted by first selecting them and then indicating that the elements should be deleted.

## GUI Design

_The State Diagram Editor needs to provide an intuitive interface for users to create and manage state diagrams efficiently. Below is a design layout and GUI components for the tool._

#### Layout

The main window consists of:
- **Toolbar**: for quick access to common actions.
- **Diagram canvas**: for showing the rendered diagram and selecting states, choice-points, and transitions.
- **Protocol panel**: for showing the list of interfaces and messages.
- **Properties panel**: for detailed editing of selected diagram elements.

These components are described in more detail below.

#### Toolbar

The toolbar provides quick access to common actions. The following table lists the buttons, their functions and the condition when they are enabled.

| Button | Function | Enabled |
|:--- |:--- |:--- |
| New | Start a new diagram. | Always |
| Open | Load an existing PlantUML file. | Always |
| Save | Save the current diagram as a PlantUML file. | Always |
| Delete | Delete the selected diagram elements. | One or more diagram elements are selected. |
| Add state | Add a new state to the diagram. | Always |
| Add choice-point | Add a new choice-point to the diagram. | Always |
| Add transition | Add a new transition to the diagram. | Two states or a state and a choice-point are selected. |
| Undo | Step backward in the edit history. | The edit history is not empty and the current action is not the first action in the history. |
| Redo | Step forward in the edit history. | The edit history is not empty and the current action is not the last action in the history. |
| Deselect all | Deselect all selected diagram elements. | One or more diagram elements are selected. |

#### Diagram Canvas

The diagram canvas displays the state diagram as rendered by the PlantUML server which returns a static PNG image. As such no dragging and dropping of elements is not allowed. However, the user can select elements by clicking on them. This is achieved by creating and using a selection mask as described in ["Selection mask"](#selection-mask).

#### Protocol Panel

The protocol panel shows the list of interfaces and a list of messages.

The list of messages can be filtered by selecting an interface from the list of interfaces. When no interface is selected, all possible messages are shown.

#### Properties Panel

The properties panel allows detailed editing of selected diagram elements.

The following lists the properties that can be edited for each type of element:

- Interface: name
- Message: interface, name
- State: name, and optionally display name
- Choice-point: name, question
- Transition: messages and connector
- Initial state transition: connector
- Self-transition: messages

### Selection mask

The PlantUML server takes the PlantUML code and generates a PNG image of the diagram which is displayed in the diagram canvas. This means that the actual location of the elements in the diagram canvas is not known to the application.

To implement the selection of elements, a copy of the diagram is made in which the following is changed in the formatting section:
- All text for both states and arrows is made transparent by setting the font color to `#00000000`.
- The thickness of the arrows is increased to 8 to make them easier to click on.

Then, each element is given an identifier, starting at 1 (the `START` icon already has identifier 0) and in the order the element appears in the diagram.

This identifier is then used as the color of the element as follows:

```
#0000hh
```

Where `hh` is the hexadecimal representation of the identifier.

The following PlantUML code shows the changes for the earlier diagram:

```
@startuml
' == Formatting ==
hide empty description
skinparam Arrow {
  FontSize 9
  Thickness 8
  FontColor #00000000
}
skinparam State {
  FontSize 12
  FontColor #00000000
}

' == Default messages ==
!$Timeout = Timeout
!$No = No
!$Yes = Yes

' == Interfaces ==
!$RTx = "RTx"

' == Messages ==
!$RTx_ConnectReq = $RTx + ":" + "ConnectReq"
!$RTx_ConnectedInd = $RTx + ":" + "ConnectedInd"
!$RTx_DisconnectInd = $RTx + ":" + "DisconnectInd"

state component as "Node" {

state START <<start>> #000000

' == States ==
state Advertising #000001;line:000001
state Connecting #000002;line:000002
state ServerConnected as "Server\nConnected" #000003;line:000003

' == Choice-points ==
state CP_Whitelisted as "Is Server\nWhitelisted?" #000004;line:000004

' == Transitions ==
START -[#000004]-> Advertising
Advertising -[#000005]-> Advertising : $Timeout
Advertising -[#000006]-> CP_Whitelisted : $RTx_ConnectReq
CP_Whitelisted -[#000007]-> Connecting : $Yes
CP_Whitelisted -[#000008]up--> Advertising : $No
Connecting -[#000009]-> Advertising : $Timeout
Connecting -[#00000A]> ServerConnected : $RTx_ConnectedInd
ServerConnected -[#00000B]-> Advertising : $RTx_DisconnectInd\n$Timeout
ServerConnected -[#00000C]-> ServerConnected : $RTx_ConnectedInd
}
@enduml
```

This renders as follows:

![](https://www.plantuml.com/plantuml/png/ZPBVRzCm4CVV_LSS0Oa7L8br0xQmbfLCI7sWGcqaX5WrMSbjjPROmNRumRJ_7ISvjsxIIlGXFVi-z_NNvxiobcjRbmLx2PC9V5AwvDOAUUzMR2Do12mh-mToD9aMbHLAClCWPCKrBs6cjVe5ZmnSeRGhyHVXmYtIZSWU91e3vvHALA4qF7zDF_OKYAmijxWlSZ8-MjVvlCOxNXSMIZI6twDft3vxaOeILMrX0XIvlOLoouLoqRS60_SbZRcqgEzuvgkNwM-NZznVHCHdh-xpjucI4ZExn1yERIjUGHH7pNUNYlPXpESoFunJqXTS2vDrsuSgzhBEecdxbgcoKXAb1MuWMgWS8tZqoLKwMwPmUTa-ydJg6qdNQnjlN4JqBF-9sWhZNf_8a_U5a1XtCL5aV0UD0sZi3qRjjBPtRBrrUpToknkHm6aWS4hUaeqI6Oug9QGDB2PVRhzkXCL262yxD-2LWzG7BtuMY9-HUAgvDAAPvLQwwzBeEtLdFPg6hM11l8NUz228mK_VGVwju_lcO-YD5Ei1llXTKqmOdUMc-1XzlgwhqT3TGh50miCNn-zn29-jfuEdZM4mxApF-FgFm-E6WtyZlOMZEedJ-IyZJ-mAPLwNnJy0)

This image is not displayed in the diagram canvas but kept in memory. When the user clicks on the original diagram, the coordinates of the click are used to retrieve the color of the element at the same coordinates in the selection diagram. If the color matches the color of an element in the original diagram, that element is selected, or deselected when the user clicks again on the same element.

